<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>DRV_SofTimer: Common/DRV_SoftTimer.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>Common/DRV_SoftTimer.c</h1><a href="DRV__SoftTimer_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;<a class="code" href="DRV__SoftTimer_8h.html" title="Public declaration for the driver.">DRV_SoftTimer.h</a>&gt;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;<a class="code" href="DRV__SoftTimer__private_8h.html" title="Private declarations for the driver.">Inc/DRV_SoftTimer_private.h</a>&quot;</span>
<a name="l00012"></a>00012 <span class="comment">/**************************************************************</span>
<a name="l00013"></a>00013 <span class="comment">                                        Define</span>
<a name="l00014"></a>00014 <span class="comment">***************************************************************/</span>
<a name="l00015"></a><a class="code" href="DRV__SoftTimer_8c.html#a773b4b2cb68b95f0cc7ad7f6915a125c">00015</a> <span class="preprocessor">#define kDRV_SofTimer_MaxDevices 5</span>
<a name="l00016"></a>00016 <span class="preprocessor"></span><span class="comment">/**************************************************************</span>
<a name="l00017"></a>00017 <span class="comment">                                        Local variables</span>
<a name="l00018"></a>00018 <span class="comment">***************************************************************/</span>
<a name="l00022"></a>00022 <span class="keyword">static</span> <span class="keyword">struct</span>
<a name="l00023"></a>00023 {
<a name="l00024"></a><a class="code" href="DRV__SoftTimer_8c.html#a49d7a52cf3cc3d724b354e97c48d6bf7">00024</a>     <a class="code" href="structDRV__Softimer__Devicedata.html" title="SoftTimer device data.">DRV_Softimer_Devicedata</a> <a class="code" href="DRV__SoftTimer_8c.html#a49d7a52cf3cc3d724b354e97c48d6bf7">tsSoftTimers</a>[<a class="code" href="DRV__SoftTimer_8c.html#a773b4b2cb68b95f0cc7ad7f6915a125c">kDRV_SofTimer_MaxDevices</a>];
<a name="l00025"></a><a class="code" href="DRV__SoftTimer_8c.html#a19e4bea52da7bd658c3c1a6c75c73233">00025</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="DRV__SoftTimer_8c.html#a19e4bea52da7bd658c3c1a6c75c73233">ucTimerCount</a>;
<a name="l00026"></a>00026 } sDRV_SoftTimer_MainData;
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="comment">/**************************************************************</span>
<a name="l00029"></a>00029 <span class="comment">                 local Functions declaration</span>
<a name="l00030"></a>00030 <span class="comment">***************************************************************/</span>
<a name="l00031"></a>00031 <span class="keyword">static</span> <span class="keywordtype">void</span> DRV_SoftTimer_ResetValues( <a class="code" href="structDRV__Softimer__Devicedata.html" title="SoftTimer device data.">DRV_Softimer_Devicedata</a> *pTimer );
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <span class="comment">/**************************************************************</span>
<a name="l00034"></a>00034 <span class="comment">                 Public Functions</span>
<a name="l00035"></a>00035 <span class="comment">***************************************************************/</span>
<a name="l00036"></a><a class="code" href="DRV__SoftTimer_8h.html#a6a99994b15161441f08451402c37a72b">00036</a> <a class="code" href="DRV__SoftTimer_8h.html#a0c02e9e2968c38e11a4c6f3c430c96ab" title="Returned error for driver.">DRV_SoftTimer_Error</a> <a class="code" href="DRV__SoftTimer_8c.html#a6a99994b15161441f08451402c37a72b" title="Initialization the driver.">DRV_SoftTimer_Init</a>( <span class="keywordtype">void</span> )
<a name="l00037"></a>00037 {
<a name="l00038"></a>00038         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ucTimerIndex;
<a name="l00039"></a>00039 
<a name="l00040"></a>00040         <span class="comment">//init timers</span>
<a name="l00041"></a>00041         memset(sDRV_SoftTimer_MainData.tsSoftTimers , 0 , <span class="keyword">sizeof</span>(sDRV_SoftTimer_MainData.tsSoftTimers));
<a name="l00042"></a>00042         <span class="keywordflow">for</span>( ucTimerIndex=0 ; ucTimerIndex &lt; <a class="code" href="DRV__SoftTimer_8c.html#a773b4b2cb68b95f0cc7ad7f6915a125c">kDRV_SofTimer_MaxDevices</a>; ucTimerIndex++)
<a name="l00043"></a>00043         {
<a name="l00044"></a>00044             sDRV_SoftTimer_MainData.tsSoftTimers[ucTimerIndex].eState = <a class="code" href="DRV__SoftTimer__private_8h.html#a3fb333b67375561d327e9b5a8ffa03b9a30c0b4dad1e3a3b93f822b9cef26244b">Closed</a>;
<a name="l00045"></a>00045         }
<a name="l00046"></a>00046         <span class="comment">//reset the number of used timers</span>
<a name="l00047"></a>00047         sDRV_SoftTimer_MainData.ucTimerCount=0;
<a name="l00048"></a>00048         <span class="comment">//Architecture dependent init of the main timer</span>
<a name="l00049"></a>00049         <a class="code" href="DRV__SoftTimer__Linux_8c.html#a5835e63d494d14d04a5e1c1e0e8df861" title="Main Timer init.">DRV_SofTimer_MainInit</a>();
<a name="l00050"></a>00050 
<a name="l00051"></a>00051         <span class="keywordflow">return</span> <a class="code" href="DRV__SoftTimer_8h.html#a0c02e9e2968c38e11a4c6f3c430c96aba5a73f5651f9b6ff314dafa9ff2a24d66" title="OK.">No_Error</a>;
<a name="l00052"></a>00052 }
<a name="l00053"></a>00053 
<a name="l00054"></a><a class="code" href="DRV__SoftTimer_8h.html#a5c97c9129d3b735f5940df8cfd1e4056">00054</a> <a class="code" href="DRV__SoftTimer_8h.html#a0c02e9e2968c38e11a4c6f3c430c96ab" title="Returned error for driver.">DRV_SoftTimer_Error</a> <a class="code" href="DRV__SoftTimer_8c.html#a5c97c9129d3b735f5940df8cfd1e4056" title="Terminate the driver.">DRV_SoftTimer_Terminate</a>( <span class="keywordtype">void</span> )
<a name="l00055"></a>00055 {
<a name="l00056"></a>00056         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ucTimerIndex;
<a name="l00057"></a>00057 
<a name="l00058"></a>00058         <span class="comment">//Stop the main timer</span>
<a name="l00059"></a>00059         <a class="code" href="DRV__SoftTimer__Linux_8c.html#a10ca1b339d6c5ba95c0fd56475e82131" title="Main Timer init.">DRV_SofTimer_MainTerminate</a>();
<a name="l00060"></a>00060 
<a name="l00061"></a>00061         <span class="comment">//init timers</span>
<a name="l00062"></a>00062         memset(sDRV_SoftTimer_MainData.tsSoftTimers , 0 , <span class="keyword">sizeof</span>(sDRV_SoftTimer_MainData.tsSoftTimers));
<a name="l00063"></a>00063         <span class="keywordflow">for</span>( ucTimerIndex=0 ; ucTimerIndex &lt; <a class="code" href="DRV__SoftTimer_8c.html#a773b4b2cb68b95f0cc7ad7f6915a125c">kDRV_SofTimer_MaxDevices</a>; ucTimerIndex++)
<a name="l00064"></a>00064         {
<a name="l00065"></a>00065             sDRV_SoftTimer_MainData.tsSoftTimers[ucTimerIndex].eState = <a class="code" href="DRV__SoftTimer__private_8h.html#a3fb333b67375561d327e9b5a8ffa03b9a30c0b4dad1e3a3b93f822b9cef26244b">Closed</a>;
<a name="l00066"></a>00066         }
<a name="l00067"></a>00067         <span class="comment">//reset the number of used timers</span>
<a name="l00068"></a>00068         sDRV_SoftTimer_MainData.ucTimerCount=0;
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 
<a name="l00072"></a>00072         <span class="keywordflow">return</span> <a class="code" href="DRV__SoftTimer_8h.html#a0c02e9e2968c38e11a4c6f3c430c96aba5a73f5651f9b6ff314dafa9ff2a24d66" title="OK.">No_Error</a>;
<a name="l00073"></a>00073 }
<a name="l00074"></a>00074 
<a name="l00075"></a><a class="code" href="DRV__SoftTimer_8h.html#a40016f0a5aa4225b172db78244fb6f57">00075</a> <a class="code" href="DRV__SoftTimer_8h.html#a0c02e9e2968c38e11a4c6f3c430c96ab" title="Returned error for driver.">DRV_SoftTimer_Error</a> <a class="code" href="DRV__SoftTimer_8c.html#a40016f0a5aa4225b172db78244fb6f57" title="Open an instance of the driver.">DRV_SoftTimer_Open</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> * pcDeviceName , <a class="code" href="DRV__SoftTimer_8h.html#ab108f74642c0b33cf13f92b61232680b" title="Handle for device.">DRV_SoftTimer_Handle</a> *phDeviceHandle , <a class="code" href="structDRV__SoftTimer__Cfg.html" title="configuration parameters for device">DRV_SoftTimer_Cfg</a> *ptParam)
<a name="l00076"></a>00076 {
<a name="l00077"></a>00077         <a class="code" href="structDRV__Softimer__Devicedata.html" title="SoftTimer device data.">DRV_Softimer_Devicedata</a> *pTimer;
<a name="l00078"></a>00078 
<a name="l00079"></a>00079         <span class="keywordflow">if</span>( sDRV_SoftTimer_MainData.ucTimerCount &gt;= <a class="code" href="DRV__SoftTimer_8c.html#a773b4b2cb68b95f0cc7ad7f6915a125c">kDRV_SofTimer_MaxDevices</a> )
<a name="l00080"></a>00080           <span class="keywordflow">return</span> <a class="code" href="DRV__SoftTimer_8h.html#a0c02e9e2968c38e11a4c6f3c430c96aba1f506c828f4945d6b5a7bf71445f7d54" title="generic error">Failed</a>;
<a name="l00081"></a>00081 
<a name="l00082"></a>00082         <span class="comment">//Get the new timer pointer</span>
<a name="l00083"></a>00083         pTimer= &amp;sDRV_SoftTimer_MainData.tsSoftTimers[sDRV_SoftTimer_MainData.ucTimerCount];
<a name="l00084"></a>00084         <span class="comment">//Set the conf parameters</span>
<a name="l00085"></a>00085         pTimer-&gt;<a class="code" href="structDRV__Softimer__Devicedata.html#ac9fb284c482b2d068869266408221900" title="Driver configuration.">cfg</a> = *ptParam;
<a name="l00086"></a>00086         pTimer-&gt;<a class="code" href="structDRV__Softimer__Devicedata.html#a99398758934eaf9c659e0a4e1a67a933">eState</a> =  <a class="code" href="DRV__SoftTimer__private_8h.html#a3fb333b67375561d327e9b5a8ffa03b9a73e5e3627dfa268bdbf7c39ff83c0c8e">stopped</a>;
<a name="l00087"></a>00087         DRV_SoftTimer_ResetValues( pTimer );
<a name="l00088"></a>00088         <a class="code" href="DRV__SoftTimer__Linux_8c.html#afed9df0b948e77fea6b8105eef5d1516" title="Safe section enter.">DRV_SoftTimer_SafeEnter</a>();
<a name="l00089"></a>00089         <span class="comment">//update the number of opened timer</span>
<a name="l00090"></a>00090         sDRV_SoftTimer_MainData.ucTimerCount++;
<a name="l00091"></a>00091         <a class="code" href="DRV__SoftTimer__Linux_8c.html#a243a2eab7f681d3913b846cded0489dd" title="Safe section leave.">DRV_SoftTimer_SafeLeave</a>();
<a name="l00092"></a>00092 
<a name="l00093"></a>00093         *phDeviceHandle = (<a class="code" href="DRV__SoftTimer_8h.html#ab108f74642c0b33cf13f92b61232680b" title="Handle for device.">DRV_SoftTimer_Handle</a>) pTimer;
<a name="l00094"></a>00094         <span class="keywordflow">return</span> <a class="code" href="DRV__SoftTimer_8h.html#a0c02e9e2968c38e11a4c6f3c430c96aba5a73f5651f9b6ff314dafa9ff2a24d66" title="OK.">No_Error</a>;
<a name="l00095"></a>00095 }
<a name="l00096"></a>00096 
<a name="l00097"></a><a class="code" href="DRV__SoftTimer_8h.html#ad0c50ffed82a4f27791aa196d459fb06">00097</a> <a class="code" href="DRV__SoftTimer_8h.html#a0c02e9e2968c38e11a4c6f3c430c96ab" title="Returned error for driver.">DRV_SoftTimer_Error</a> <a class="code" href="DRV__SoftTimer_8c.html#ad0c50ffed82a4f27791aa196d459fb06" title="Close an instance of the driver.">DRV_SoftTimer_Close</a>( <a class="code" href="DRV__SoftTimer_8h.html#ab108f74642c0b33cf13f92b61232680b" title="Handle for device.">DRV_SoftTimer_Handle</a> hDeviceHandle )
<a name="l00098"></a>00098 {
<a name="l00099"></a>00099         <a class="code" href="structDRV__Softimer__Devicedata.html" title="SoftTimer device data.">DRV_Softimer_Devicedata</a> *pTimer = (<a class="code" href="structDRV__Softimer__Devicedata.html" title="SoftTimer device data.">DRV_Softimer_Devicedata</a> *) hDeviceHandle;
<a name="l00100"></a>00100 
<a name="l00101"></a>00101         <span class="keywordflow">if</span>( pTimer == NULL )
<a name="l00102"></a>00102            <span class="keywordflow">return</span> <a class="code" href="DRV__SoftTimer_8h.html#a0c02e9e2968c38e11a4c6f3c430c96aba66afabd563a3626d1f53c988c763412e" title="A input parameter pointer is NULL.">Input_Null</a>;
<a name="l00103"></a>00103 
<a name="l00104"></a>00104         <a class="code" href="DRV__SoftTimer__Linux_8c.html#afed9df0b948e77fea6b8105eef5d1516" title="Safe section enter.">DRV_SoftTimer_SafeEnter</a>();
<a name="l00105"></a>00105         pTimer-&gt;<a class="code" href="structDRV__Softimer__Devicedata.html#a99398758934eaf9c659e0a4e1a67a933">eState</a> = <a class="code" href="DRV__SoftTimer__private_8h.html#a3fb333b67375561d327e9b5a8ffa03b9a30c0b4dad1e3a3b93f822b9cef26244b">Closed</a>;
<a name="l00106"></a>00106         <a class="code" href="DRV__SoftTimer__Linux_8c.html#a243a2eab7f681d3913b846cded0489dd" title="Safe section leave.">DRV_SoftTimer_SafeLeave</a>();
<a name="l00107"></a>00107 
<a name="l00108"></a>00108         <span class="keywordflow">return</span> <a class="code" href="DRV__SoftTimer_8h.html#a0c02e9e2968c38e11a4c6f3c430c96aba5a73f5651f9b6ff314dafa9ff2a24d66" title="OK.">No_Error</a>;
<a name="l00109"></a>00109 }
<a name="l00110"></a>00110 
<a name="l00111"></a><a class="code" href="DRV__SoftTimer_8h.html#a73c3738cb21e949139bf0a3c1a9938d7">00111</a> <a class="code" href="DRV__SoftTimer_8h.html#a0c02e9e2968c38e11a4c6f3c430c96ab" title="Returned error for driver.">DRV_SoftTimer_Error</a> <a class="code" href="DRV__SoftTimer_8c.html#a73c3738cb21e949139bf0a3c1a9938d7" title="Start the timer.">DRV_SoftTimer_Start</a>( <a class="code" href="DRV__SoftTimer_8h.html#ab108f74642c0b33cf13f92b61232680b" title="Handle for device.">DRV_SoftTimer_Handle</a> hDeviceHandle )
<a name="l00112"></a>00112 {
<a name="l00113"></a>00113         <a class="code" href="structDRV__Softimer__Devicedata.html" title="SoftTimer device data.">DRV_Softimer_Devicedata</a> *pTimer = (<a class="code" href="structDRV__Softimer__Devicedata.html" title="SoftTimer device data.">DRV_Softimer_Devicedata</a> *) hDeviceHandle;
<a name="l00114"></a>00114 
<a name="l00115"></a>00115         <span class="keywordflow">if</span>( pTimer == NULL )
<a name="l00116"></a>00116           <span class="keywordflow">return</span> <a class="code" href="DRV__SoftTimer_8h.html#a0c02e9e2968c38e11a4c6f3c430c96aba66afabd563a3626d1f53c988c763412e" title="A input parameter pointer is NULL.">Input_Null</a>;
<a name="l00117"></a>00117 
<a name="l00118"></a>00118         <span class="keywordflow">if</span>( pTimer-&gt;<a class="code" href="structDRV__Softimer__Devicedata.html#a99398758934eaf9c659e0a4e1a67a933">eState</a> != <a class="code" href="DRV__SoftTimer__private_8h.html#a3fb333b67375561d327e9b5a8ffa03b9a30c0b4dad1e3a3b93f822b9cef26244b">Closed</a> )
<a name="l00119"></a>00119         {
<a name="l00120"></a>00120             <a class="code" href="DRV__SoftTimer__Linux_8c.html#afed9df0b948e77fea6b8105eef5d1516" title="Safe section enter.">DRV_SoftTimer_SafeEnter</a>();
<a name="l00121"></a>00121             pTimer-&gt;<a class="code" href="structDRV__Softimer__Devicedata.html#a99398758934eaf9c659e0a4e1a67a933">eState</a> =  <a class="code" href="DRV__SoftTimer__private_8h.html#a3fb333b67375561d327e9b5a8ffa03b9a79ac82b7d6de0a99e1eb157abe0cc38d">started</a>;
<a name="l00122"></a>00122             <a class="code" href="DRV__SoftTimer__Linux_8c.html#a243a2eab7f681d3913b846cded0489dd" title="Safe section leave.">DRV_SoftTimer_SafeLeave</a>();
<a name="l00123"></a>00123         }
<a name="l00124"></a>00124         <span class="keywordflow">return</span> <a class="code" href="DRV__SoftTimer_8h.html#a0c02e9e2968c38e11a4c6f3c430c96aba5a73f5651f9b6ff314dafa9ff2a24d66" title="OK.">No_Error</a>;
<a name="l00125"></a>00125 
<a name="l00126"></a>00126 }
<a name="l00127"></a>00127 
<a name="l00128"></a><a class="code" href="DRV__SoftTimer_8h.html#af1caa21422306e87d9ef61fd3f8ec4b6">00128</a> <a class="code" href="DRV__SoftTimer_8h.html#a0c02e9e2968c38e11a4c6f3c430c96ab" title="Returned error for driver.">DRV_SoftTimer_Error</a> <a class="code" href="DRV__SoftTimer_8c.html#af1caa21422306e87d9ef61fd3f8ec4b6" title="Stop the timer.">DRV_SoftTimer_Stop</a>( <a class="code" href="DRV__SoftTimer_8h.html#ab108f74642c0b33cf13f92b61232680b" title="Handle for device.">DRV_SoftTimer_Handle</a> hDeviceHandle )
<a name="l00129"></a>00129 {
<a name="l00130"></a>00130         <a class="code" href="structDRV__Softimer__Devicedata.html" title="SoftTimer device data.">DRV_Softimer_Devicedata</a> *pTimer = (<a class="code" href="structDRV__Softimer__Devicedata.html" title="SoftTimer device data.">DRV_Softimer_Devicedata</a> *) hDeviceHandle;
<a name="l00131"></a>00131 
<a name="l00132"></a>00132         <span class="keywordflow">if</span>( pTimer == NULL )
<a name="l00133"></a>00133           <span class="keywordflow">return</span> <a class="code" href="DRV__SoftTimer_8h.html#a0c02e9e2968c38e11a4c6f3c430c96aba66afabd563a3626d1f53c988c763412e" title="A input parameter pointer is NULL.">Input_Null</a>;
<a name="l00134"></a>00134 
<a name="l00135"></a>00135         <span class="keywordflow">if</span>( pTimer-&gt;<a class="code" href="structDRV__Softimer__Devicedata.html#a99398758934eaf9c659e0a4e1a67a933">eState</a> != <a class="code" href="DRV__SoftTimer__private_8h.html#a3fb333b67375561d327e9b5a8ffa03b9a30c0b4dad1e3a3b93f822b9cef26244b">Closed</a> )
<a name="l00136"></a>00136         {
<a name="l00137"></a>00137             <a class="code" href="DRV__SoftTimer__Linux_8c.html#afed9df0b948e77fea6b8105eef5d1516" title="Safe section enter.">DRV_SoftTimer_SafeEnter</a>();
<a name="l00138"></a>00138             pTimer-&gt;<a class="code" href="structDRV__Softimer__Devicedata.html#a99398758934eaf9c659e0a4e1a67a933">eState</a> =  <a class="code" href="DRV__SoftTimer__private_8h.html#a3fb333b67375561d327e9b5a8ffa03b9a73e5e3627dfa268bdbf7c39ff83c0c8e">stopped</a>;
<a name="l00139"></a>00139             <a class="code" href="DRV__SoftTimer__Linux_8c.html#a243a2eab7f681d3913b846cded0489dd" title="Safe section leave.">DRV_SoftTimer_SafeLeave</a>();
<a name="l00140"></a>00140         }
<a name="l00141"></a>00141         <span class="keywordflow">return</span> <a class="code" href="DRV__SoftTimer_8h.html#a0c02e9e2968c38e11a4c6f3c430c96aba5a73f5651f9b6ff314dafa9ff2a24d66" title="OK.">No_Error</a>;
<a name="l00142"></a>00142 }
<a name="l00143"></a>00143 
<a name="l00144"></a><a class="code" href="DRV__SoftTimer_8h.html#a25c85982fa2fd7595f5daec2fcc1275f">00144</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="DRV__SoftTimer_8c.html#a381d31cfba026ee08b4ae72fa6603cbd" title="Get The Timer value.">DRV_SoftTimer_GetValue</a>( <a class="code" href="DRV__SoftTimer_8h.html#ab108f74642c0b33cf13f92b61232680b" title="Handle for device.">DRV_SoftTimer_Handle</a> hDeviceHandle )
<a name="l00145"></a>00145 {
<a name="l00146"></a>00146         <a class="code" href="structDRV__Softimer__Devicedata.html" title="SoftTimer device data.">DRV_Softimer_Devicedata</a> *pTimer = (<a class="code" href="structDRV__Softimer__Devicedata.html" title="SoftTimer device data.">DRV_Softimer_Devicedata</a> *) hDeviceHandle;
<a name="l00147"></a>00147         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uiReturnedValue;
<a name="l00148"></a>00148 
<a name="l00149"></a>00149         <span class="keywordflow">if</span>( pTimer == NULL )
<a name="l00150"></a>00150           <span class="keywordflow">return</span> 0;
<a name="l00151"></a>00151         <span class="keywordflow">if</span>( pTimer-&gt;<a class="code" href="structDRV__Softimer__Devicedata.html#a99398758934eaf9c659e0a4e1a67a933">eState</a> != <a class="code" href="DRV__SoftTimer__private_8h.html#a3fb333b67375561d327e9b5a8ffa03b9a30c0b4dad1e3a3b93f822b9cef26244b">Closed</a> )
<a name="l00152"></a>00152         {
<a name="l00153"></a>00153             <a class="code" href="DRV__SoftTimer__Linux_8c.html#afed9df0b948e77fea6b8105eef5d1516" title="Safe section enter.">DRV_SoftTimer_SafeEnter</a>();
<a name="l00154"></a>00154             uiReturnedValue = pTimer-&gt;<a class="code" href="structDRV__Softimer__Devicedata.html#acbe2aa88651ff3fdbdd122151f57e8b7" title="User value.">uiReturnedValue</a>;
<a name="l00155"></a>00155             <a class="code" href="DRV__SoftTimer__Linux_8c.html#a243a2eab7f681d3913b846cded0489dd" title="Safe section leave.">DRV_SoftTimer_SafeLeave</a>();
<a name="l00156"></a>00156         }
<a name="l00157"></a>00157         <span class="keywordflow">return</span>  uiReturnedValue;
<a name="l00158"></a>00158 }
<a name="l00159"></a>00159 
<a name="l00160"></a><a class="code" href="DRV__SoftTimer_8h.html#a9dc132a9dc8fc39061c488db40ce159a">00160</a> <span class="keywordtype">void</span> <a class="code" href="DRV__SoftTimer_8c.html#a65b4db64d649be15f57c5ae0f4945e3a" title="Reset The Timer value.">DRV_SoftTimer_Reset</a>( <a class="code" href="DRV__SoftTimer_8h.html#ab108f74642c0b33cf13f92b61232680b" title="Handle for device.">DRV_SoftTimer_Handle</a> hDeviceHandle )
<a name="l00161"></a>00161 {
<a name="l00162"></a>00162         <a class="code" href="structDRV__Softimer__Devicedata.html" title="SoftTimer device data.">DRV_Softimer_Devicedata</a> *pTimer = (<a class="code" href="structDRV__Softimer__Devicedata.html" title="SoftTimer device data.">DRV_Softimer_Devicedata</a> *) hDeviceHandle;
<a name="l00163"></a>00163 
<a name="l00164"></a>00164         <span class="keywordflow">if</span>( pTimer == NULL )
<a name="l00165"></a>00165           return ;
<a name="l00166"></a>00166 
<a name="l00167"></a>00167         <span class="keywordflow">if</span>( pTimer-&gt;<a class="code" href="structDRV__Softimer__Devicedata.html#a99398758934eaf9c659e0a4e1a67a933">eState</a> != <a class="code" href="DRV__SoftTimer__private_8h.html#a3fb333b67375561d327e9b5a8ffa03b9a30c0b4dad1e3a3b93f822b9cef26244b">Closed</a> )
<a name="l00168"></a>00168         {
<a name="l00169"></a>00169             <a class="code" href="DRV__SoftTimer__Linux_8c.html#afed9df0b948e77fea6b8105eef5d1516" title="Safe section enter.">DRV_SoftTimer_SafeEnter</a>();
<a name="l00170"></a>00170             DRV_SoftTimer_ResetValues( pTimer );
<a name="l00171"></a>00171             <a class="code" href="DRV__SoftTimer__Linux_8c.html#a243a2eab7f681d3913b846cded0489dd" title="Safe section leave.">DRV_SoftTimer_SafeLeave</a>();
<a name="l00172"></a>00172         }
<a name="l00173"></a>00173 
<a name="l00174"></a>00174 }
<a name="l00175"></a>00175 
<a name="l00176"></a>00176 <span class="comment">/**************************************************************</span>
<a name="l00177"></a>00177 <span class="comment">                 private Functions</span>
<a name="l00178"></a>00178 <span class="comment">***************************************************************/</span>
<a name="l00179"></a>00179 
<a name="l00180"></a><a class="code" href="DRV__SoftTimer__private_8h.html#ab8f05bbad4f00c0c7c2c62f4a52b4580">00180</a> <span class="keywordtype">void</span> <a class="code" href="DRV__SoftTimer_8c.html#ab8f05bbad4f00c0c7c2c62f4a52b4580" title="Called by the Main Timer.">DRV_Softimer_TimerCallBack</a>( <span class="keywordtype">void</span> )
<a name="l00181"></a>00181 {
<a name="l00182"></a>00182         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ucTimerIndex;
<a name="l00183"></a>00183 
<a name="l00184"></a>00184         <span class="comment">//update timers</span>
<a name="l00185"></a>00185         <span class="keywordflow">for</span>( ucTimerIndex=0 ; ucTimerIndex &lt; <a class="code" href="DRV__SoftTimer_8c.html#a773b4b2cb68b95f0cc7ad7f6915a125c">kDRV_SofTimer_MaxDevices</a>; ucTimerIndex++)
<a name="l00186"></a>00186         {
<a name="l00187"></a>00187 
<a name="l00188"></a>00188                 <span class="keywordflow">if</span>( sDRV_SoftTimer_MainData.tsSoftTimers[ucTimerIndex].eState == <a class="code" href="DRV__SoftTimer__private_8h.html#a3fb333b67375561d327e9b5a8ffa03b9a79ac82b7d6de0a99e1eb157abe0cc38d">started</a> )
<a name="l00189"></a>00189                 {
<a name="l00190"></a>00190                         <span class="keywordflow">switch</span>( sDRV_SoftTimer_MainData.tsSoftTimers[ucTimerIndex].cfg.tType )
<a name="l00191"></a>00191                         {
<a name="l00192"></a>00192                                 <span class="keywordflow">case</span> <a class="code" href="DRV__SoftTimer_8h.html#a12e3bb359c2e483fd2854beb684ead1aadd85f215c2788e34d4aa67d41a8ba9c4" title="increment when the main timer reach DRV_SoftTimer_Cfg::uiValue">Counter</a>:
<a name="l00193"></a>00193                                   <span class="keywordflow">if</span>( ( ++sDRV_SoftTimer_MainData.tsSoftTimers[ucTimerIndex].uiCountValue) &gt;= sDRV_SoftTimer_MainData.tsSoftTimers[ucTimerIndex].cfg.uiValue)
<a name="l00194"></a>00194                                     sDRV_SoftTimer_MainData.tsSoftTimers[ucTimerIndex].uiReturnedValue++;
<a name="l00195"></a>00195                                   <span class="keywordflow">break</span>;
<a name="l00196"></a>00196                                 <span class="keywordflow">case</span> <a class="code" href="DRV__SoftTimer_8h.html#a12e3bb359c2e483fd2854beb684ead1aa4709aff281a5471096fd9dc9418c22a8" title="start at DRV_SoftTimer_Cfg::uiValue , and decrement">TimeOut</a>:
<a name="l00197"></a>00197                                   <span class="keywordflow">if</span>(sDRV_SoftTimer_MainData.tsSoftTimers[ucTimerIndex].uiCountValue)
<a name="l00198"></a>00198                                   {
<a name="l00199"></a>00199                                       sDRV_SoftTimer_MainData.tsSoftTimers[ucTimerIndex].uiCountValue--;
<a name="l00200"></a>00200                                       sDRV_SoftTimer_MainData.tsSoftTimers[ucTimerIndex].uiReturnedValue = sDRV_SoftTimer_MainData.tsSoftTimers[ucTimerIndex].uiCountValue;
<a name="l00201"></a>00201                                   }
<a name="l00202"></a>00202                                   <span class="keywordflow">break</span>;
<a name="l00203"></a>00203                                 <span class="keywordflow">case</span> <a class="code" href="DRV__SoftTimer_8h.html#a12e3bb359c2e483fd2854beb684ead1aa6db09e3bc054df6f996a45de2ccfeacd" title="Execute the callback function periodically.">Periodic</a>:
<a name="l00204"></a>00204                                   <span class="keywordflow">break</span>;
<a name="l00205"></a>00205                                 <span class="keywordflow">default</span>:
<a name="l00206"></a>00206                                   <span class="keywordflow">break</span>;
<a name="l00207"></a>00207                         }
<a name="l00208"></a>00208                 }
<a name="l00209"></a>00209         }
<a name="l00210"></a>00210 }
<a name="l00211"></a>00211 
<a name="l00215"></a>00215 <span class="keyword">static</span> <span class="keywordtype">void</span> DRV_SoftTimer_ResetValues( <a class="code" href="structDRV__Softimer__Devicedata.html" title="SoftTimer device data.">DRV_Softimer_Devicedata</a> *pTimer )
<a name="l00216"></a>00216 {
<a name="l00217"></a>00217     pTimer-&gt;<a class="code" href="structDRV__Softimer__Devicedata.html#a23cd336a5e8e92e3e63359a932def2b7" title="internal count value">uiCountValue</a> = pTimer-&gt;<a class="code" href="structDRV__Softimer__Devicedata.html#ac9fb284c482b2d068869266408221900" title="Driver configuration.">cfg</a>.<a class="code" href="structDRV__SoftTimer__Cfg.html#a0905f7659873c81cfed0090518b27c81" title="Value of the timer.">uiValue</a> ;
<a name="l00218"></a>00218     <span class="keywordflow">if</span>( pTimer-&gt;<a class="code" href="structDRV__Softimer__Devicedata.html#ac9fb284c482b2d068869266408221900" title="Driver configuration.">cfg</a>.<a class="code" href="structDRV__SoftTimer__Cfg.html#a3598ca96d645a5587b44f27b24f154a0" title="Type of timer.">tType</a> !=  <a class="code" href="DRV__SoftTimer_8h.html#a12e3bb359c2e483fd2854beb684ead1aa4709aff281a5471096fd9dc9418c22a8" title="start at DRV_SoftTimer_Cfg::uiValue , and decrement">TimeOut</a> )
<a name="l00219"></a>00219       pTimer-&gt;<a class="code" href="structDRV__Softimer__Devicedata.html#acbe2aa88651ff3fdbdd122151f57e8b7" title="User value.">uiReturnedValue</a> = 0;
<a name="l00220"></a>00220     <span class="keywordflow">else</span>
<a name="l00221"></a>00221       pTimer-&gt;<a class="code" href="structDRV__Softimer__Devicedata.html#acbe2aa88651ff3fdbdd122151f57e8b7" title="User value.">uiReturnedValue</a> = pTimer-&gt;<a class="code" href="structDRV__Softimer__Devicedata.html#ac9fb284c482b2d068869266408221900" title="Driver configuration.">cfg</a>.<a class="code" href="structDRV__SoftTimer__Cfg.html#a0905f7659873c81cfed0090518b27c81" title="Value of the timer.">uiValue</a> ;
<a name="l00222"></a>00222 }
<a name="l00223"></a>00223 
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on Sun Feb 7 21:57:50 2010 for DRV_SofTimer by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
